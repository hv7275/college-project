<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Todo App{% endblock %}</title>
  <link rel="stylesheet"
    href="{{ url_for('static', filename='css/style.css') }}{% if cache_buster %}?v={{ cache_buster }}{% endif %}" />
</head>

<body>
  <header class="navbar">
    <div class="navbar-container">
      <div class="navbar-brand">
        <a href="{{ url_for('tasks.view_task')}}" class="brand-link">
          <span class="brand-icon">📝</span>
          <span class="brand-text">My Todo-App</span>
        </a>
      </div>
      
      <nav class="navbar-nav">
        <div class="nav-links">
          <a href="{{ url_for('tasks.view_task')}}" class="nav-link">
            <span class="nav-icon">🏠</span>
            <span class="nav-text">Home</span>
          </a>
          {% if current_user.is_authenticated %}
          <a href="{{ url_for('tasks.view_task')}}" class="nav-link">
            <span class="nav-icon">📋</span>
            <span class="nav-text">Tasks</span>
          </a>
          <a href="{{ url_for('tasks.task_history')}}" class="nav-link">
            <span class="nav-icon">📊</span>
            <span class="nav-text">History</span>
          </a>
          {% endif %}
        </div>
        
        <div class="nav-auth">
          {% if current_user.is_authenticated %}
          <div class="user-menu">
            <button class="user-toggle" onclick="toggleUserMenu()">
              <span class="user-avatar">{{ current_user.first_name[0] if current_user.first_name else current_user.username[0] }}</span>
              <span class="user-name">{{ current_user.first_name or current_user.username }}</span>
              <span class="dropdown-arrow">▼</span>
            </button>
            <div class="user-dropdown" id="userDropdown">
              <div class="user-info">
                <div class="user-details">
                  <div class="user-full-name">{{ current_user.first_name }} {{ current_user.last_name }}</div>
                  <div class="user-email">{{ current_user.email }}</div>
                </div>
              </div>
              <div class="dropdown-divider"></div>
              <a href="{{ url_for('auth.logout')}}" class="dropdown-link logout-link">
                <span class="dropdown-icon">🚪</span>
                <span class="dropdown-text">Logout</span>
              </a>
            </div>
          </div>
          {% else %}
          <div class="auth-links">
            <a href="{{ url_for('auth.login')}}" class="nav-link auth-link">
              <span class="nav-icon">🔑</span>
              <span class="nav-text">Login</span>
            </a>
            <a href="{{ url_for('auth.register')}}" class="nav-link auth-link register-link">
              <span class="nav-icon">📝</span>
              <span class="nav-text">Register</span>
            </a>
          </div>
          {% endif %}
        </div>
      </nav>
      
      <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
    </div>
    
    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
      <div class="mobile-menu-content">
        <a href="{{ url_for('tasks.view_task')}}" class="mobile-nav-link">
          <span class="nav-icon">🏠</span>
          <span class="nav-text">Home</span>
        </a>
        {% if current_user.is_authenticated %}
        <a href="{{ url_for('tasks.view_task')}}" class="mobile-nav-link">
          <span class="nav-icon">📋</span>
          <span class="nav-text">Tasks</span>
        </a>
        <a href="{{ url_for('tasks.task_history')}}" class="mobile-nav-link">
          <span class="nav-icon">📊</span>
          <span class="nav-text">History</span>
        </a>
        <div class="mobile-user-info">
          <div class="mobile-user-avatar">{{ current_user.first_name[0] if current_user.first_name else current_user.username[0] }}</div>
          <div class="mobile-user-details">
            <div class="mobile-user-name">{{ current_user.first_name or current_user.username }}</div>
            <div class="mobile-user-email">{{ current_user.email }}</div>
          </div>
        </div>
        <a href="{{ url_for('auth.logout')}}" class="mobile-nav-link logout-link">
          <span class="nav-icon">🚪</span>
          <span class="nav-text">Logout</span>
        </a>
        {% else %}
        <a href="{{ url_for('auth.login')}}" class="mobile-nav-link">
          <span class="nav-icon">🔑</span>
          <span class="nav-text">Login</span>
        </a>
        <a href="{{ url_for('auth.register')}}" class="mobile-nav-link register-link">
          <span class="nav-icon">📝</span>
          <span class="nav-text">Register</span>
        </a>
        {% endif %}
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="flash {{ category }}" id="flash-{{ loop.index }}">
      <span class="flash-content">{{ message }}</span>
      <button class="flash-close" onclick="closeFlash('flash-{{ loop.index }}')"
        aria-label="Close message">&times;</button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>My Todo-App</h3>
          <p style="color: #4b8bcf;">Organize your tasks efficiently and stay productive with our intuitive task
            management system.</p>
          <div class="social-links">
            <a href="#" class="social-link" title="GitHub">
              <span>📱</span>
            </a>
            <a href="#" class="social-link" title="LinkedIn">
              <span>💼</span>
            </a>
            <a href="#" class="social-link" title="Email">
              <span>📧</span>
            </a>
          </div>
        </div>

        <div class="footer-section">
          <h4>Quick Links</h4>
          <ul class="footer-links">
            <li><a href="{{ url_for('tasks.view_task') }}">Home</a></li>
            {% if 'user' in session %}
            <li><a href="{{ url_for('auth.logout') }}">Logout</a></li>
            {% else %}
            <li><a href="{{ url_for('auth.login') }}">Login</a></li>
            <li><a href="{{ url_for('auth.register') }}">Register</a></li>
            {% endif %}
          </ul>
        </div>

        <div class="footer-section">
          <h4>Features</h4>
          <ul class="footer-links" style="color: #5785c2;">
            <li>Task Management</li>
            <li>Status Tracking</li>
            <li>User Authentication</li>
            <li>Responsive Design</li>
          </ul>
        </div>

        <div class="footer-section">
          <h4>Contact Info</h4>
          <div class="contact-info">
            <p class="contact-info-p" style="color: #5785c2;">📧 support@todoapp.com</p>
            <p class="contact-info-p" style="color: #5785c2;">📞 +1 (555) 123-4567</p>
            <p class="contact-info-p" style="color: #5785c2;">📍 123 Task Street, Productivity City</p>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <div class="footer-bottom-content">
          <p>&copy; 2024 My Todo-App. All rights reserved.</p>
          <div class="footer-bottom-links">
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
            <a href="#">Cookie Policy</a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script>
    function closeFlash(flashId) {
      const flashElement = document.getElementById(flashId);
      if (flashElement) {
        flashElement.style.animation = 'slideOut 0.3s ease-out forwards';
        setTimeout(() => {
          flashElement.remove();
        }, 300);
      }
    }

    // Auto-dismiss flash messages after 5 seconds
    document.addEventListener('DOMContentLoaded', function () {
      const flashMessages = document.querySelectorAll('.flash');
      flashMessages.forEach(function (flash) {
        setTimeout(function () {
          if (flash.parentNode) {
            flash.style.animation = 'slideOut 0.3s ease-out forwards';
            setTimeout(() => {
              if (flash.parentNode) {
                flash.remove();
              }
            }, 300);
          }
        }, 5000);
      });
    });

    // Mobile menu toggle
    function toggleMobileMenu() {
      const mobileMenu = document.getElementById('mobileMenu');
      const toggleButton = document.querySelector('.mobile-menu-toggle');
      
      if (mobileMenu.classList.contains('active')) {
        mobileMenu.classList.remove('active');
        toggleButton.classList.remove('active');
      } else {
        mobileMenu.classList.add('active');
        toggleButton.classList.add('active');
      }
    }

    // User dropdown toggle
    function toggleUserMenu() {
      const userDropdown = document.getElementById('userDropdown');
      const userToggle = document.querySelector('.user-toggle');
      
      if (userDropdown.classList.contains('active')) {
        userDropdown.classList.remove('active');
        userToggle.classList.remove('active');
      } else {
        userDropdown.classList.add('active');
        userToggle.classList.add('active');
      }
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
      const userDropdown = document.getElementById('userDropdown');
      const userToggle = document.querySelector('.user-toggle');
      const mobileMenu = document.getElementById('mobileMenu');
      const mobileToggle = document.querySelector('.mobile-menu-toggle');
      
      // Close user dropdown
      if (userDropdown && !userToggle.contains(event.target) && !userDropdown.contains(event.target)) {
        userDropdown.classList.remove('active');
        userToggle.classList.remove('active');
      }
      
      // Close mobile menu
      if (mobileMenu && !mobileToggle.contains(event.target) && !mobileMenu.contains(event.target)) {
        mobileMenu.classList.remove('active');
        mobileToggle.classList.remove('active');
      }
    });

    // Close mobile menu when clicking on a link
    document.addEventListener('DOMContentLoaded', function() {
      const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
      mobileNavLinks.forEach(link => {
        link.addEventListener('click', function() {
          const mobileMenu = document.getElementById('mobileMenu');
          const toggleButton = document.querySelector('.mobile-menu-toggle');
          mobileMenu.classList.remove('active');
          toggleButton.classList.remove('active');
        });
      });
    });
  </script>

  <style>
    @keyframes slideOut {
      from {
        opacity: 1;
        transform: translateX(0);
        max-height: 100px;
      }

      to {
        opacity: 0;
        transform: translateX(20px);
        max-height: 0;
        margin: 0;
        padding: 0;
      }
    }
  </style>
</body>
</html>